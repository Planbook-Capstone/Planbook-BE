version: "3.9"

services:
  # Infrastructure Services
  kafka:
    image: bitnami/kafka:3.7.0
    container_name: kafka
    restart: always
    pull_policy: missing
    ports:
      - "9092:9092"
    environment:
      KAFKA_CFG_PROCESS_ROLES: broker,controller
      KAFKA_CFG_NODE_ID: 1
      KAFKA_CFG_CONTROLLER_QUORUM_VOTERS: 1@kafka:9093
      KAFKA_CFG_LISTENERS: PLAINTEXT://0.0.0.0:9092,PLAINTEXT_INTERNAL://0.0.0.0:29092,CONTROLLER://:9093
      KAFKA_CFG_ADVERTISED_LISTENERS: PLAINTEXT://157.245.135.92:9092,PLAINTEXT_INTERNAL://kafka:29092
      KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_INTERNAL:PLAINTEXT,CONTROLLER:PLAINTEXT
      KAFKA_CFG_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_CFG_INTER_BROKER_LISTENER_NAME: PLAINTEXT_INTERNAL
      KAFKA_CFG_LOG_DIRS: /bitnami/kafka/data
      ALLOW_PLAINTEXT_LISTENER: yes
    volumes:
      - kafka_data:/bitnami/kafka
    networks:
      - planbook

  kafdrop:
    image: obsidiandynamics/kafdrop:latest
    container_name: kafdrop
    restart: always
    pull_policy: missing
    ports:
      - "9000:9000"
    environment:
      KAFKA_BROKERCONNECT: kafka:29092
      JVM_OPTS: "-Xms16M -Xmx48M"
    depends_on:
      - kafka
    networks:
      - planbook

  debezium:
    image: debezium/connect:3.0.0.Final
    container_name: debezium
    restart: always
    pull_policy: missing
    ports:
      - "8083:8083"
    environment:
      BOOTSTRAP_SERVERS: kafka:29092
      GROUP_ID: 1
      CONFIG_STORAGE_TOPIC: debezium_config
      OFFSET_STORAGE_TOPIC: debezium_offset
      STATUS_STORAGE_TOPIC: debezium_status
      CONNECT_REST_ADVERTISED_HOST_NAME: debezium
      CONNECT_GROUP_ID: "debezium-connect-group"
      KEY_CONVERTER: org.apache.kafka.connect.json.JsonConverter
      VALUE_CONVERTER: org.apache.kafka.connect.json.JsonConverter
      VALUE_CONVERTER_SCHEMAS_ENABLE: "false"
      KEY_CONVERTER_SCHEMAS_ENABLE: "false"
      PLUGIN_PATH: /kafka/connect
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      - kafka
    networks:
      - planbook

  # Management Tools
  dozzle:
    image: amir20/dozzle:latest
    container_name: dozzle
    restart: always
    pull_policy: missing
    ports:
      - "8888:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      DOZZLE_NO_ANALYTICS: true
    networks:
      - planbook

  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: always
    pull_policy: missing
    ports:
      - "9001:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    networks:
      - planbook

  # Discovery Server
  discovery-server:
    image: ${DOCKERHUB_USERNAME}/planbook-discovery-server:latest
    container_name: planbook-discovery-server
    restart: always
    pull_policy: always
    ports:
      - "${DISCOVERY_PORT}:${DISCOVERY_PORT}"
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${DISCOVERY_APP_NAME}"
      SERVER_PORT: "${DISCOVERY_PORT}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${DISCOVERY_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${DISCOVERY_FETCH_REGISTRY}"
      EUREKA_SERVER_ENABLE_SELF_PRESERVATION: "${DISCOVERY_ENABLE_SELF_PRESERVATION}"
      EUREKA_SERVER_EVICTION_INTERVAL_TIMER_IN_MS: "${DISCOVERY_EVICTION_INTERVAL_MS}"
      EUREKA_INSTANCE_HOSTNAME: discovery-server
    networks:
      - planbook

  # Identity Service
  identity-service:
    image: ${DOCKERHUB_USERNAME}/planbook-identity-service:latest
    container_name: planbook-identity-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      # Database Configuration
      SPRING_DATASOURCE_URL: "${IDENTITY_DB_URL}"
      SPRING_DATASOURCE_USERNAME: "${IDENTITY_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${IDENTITY_DB_PASSWORD}"
      # JPA Configuration
      SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      # Server Configuration
      SERVER_PORT: "8080"
      # Supabase Configuration
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      # Kafka Configuration
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      KAFKA_TOPIC_NAME_REQUEST: "${IDENTITY_KAFKA_TOPIC_REQUEST}"
      KAFKA_TOPIC_NAME_RESPONSE: "${IDENTITY_KAFKA_TOPIC_RESPONSE}"
      SPRING_KAFKA_CONSUMER_GROUP_ID: "${IDENTITY_KAFKA_CONSUMER_GROUP}"
      SPRING_KAFKA_CONSUMER_AUTO_OFFSET_RESET: "${IDENTITY_KAFKA_AUTO_OFFSET_RESET}"
      SPRING_KAFKA_CONSUMER_KEY_DESERIALIZER: "${IDENTITY_KAFKA_KEY_DESERIALIZER}"
      SPRING_KAFKA_CONSUMER_VALUE_DESERIALIZER: "${IDENTITY_KAFKA_VALUE_DESERIALIZER}"
      # Thymeleaf Configuration
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      # JWT Configuration
      SPRING_JWT_PRIVATE_KEY_PATH: "${IDENTITY_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${IDENTITY_JWT_PUBLIC_KEY_PATH}"
      # Redis Configuration
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      # Forward Headers Configuration
      SERVER_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      # OpenAPI Configuration
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      # Service Discovery Configuration
      SPRING_APPLICATION_NAME: "${IDENTITY_APP_NAME}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      EUREKA_INSTANCE_HOSTNAME: "identity-service"
      # Duration Configuration
      SPRING_DURATION: "${SHARED_DURATION_SECONDS}"
      # Mail Configuration
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      SPRING_SENDGRID_TEMPLATE_RESET_PASSWORD: "${IDENTITY_SENDGRID_TEMPLATE_RESET_PASSWORD}"
      SPRING_LINK_RESET_PASSWORD: "${IDENTITY_LINK_RESET_PASSWORD}"
      SPRING_SENDGRID_TEMPLATE_VERIFY: "${IDENTITY_SENDGRID_TEMPLATE_VERIFY}"
      SPRING_LINK_VERIFY: "${IDENTITY_LINK_VERIFY}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # API Gateway
  api-gateway:
    image: ${DOCKERHUB_USERNAME}/planbook-gateway:latest
    container_name: planbook-gateway
    restart: always
    pull_policy: always
    ports:
      - "${API_GATEWAY_PORT}:${API_GATEWAY_PORT}"
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      # Server Configuration
      SERVER_PORT: "${API_GATEWAY_PORT}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "env,configprops"
      # JWT Configuration
      SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI: "${API_GATEWAY_JWKS_URI}"
      # Service Discovery Configuration
      SPRING_APPLICATION_NAME: "${API_GATEWAY_APP_NAME}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "false"
      EUREKA_INSTANCE_HOSTNAME: "api-gateway"
      # Gateway Configuration
      SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_ENABLED: "${API_GATEWAY_DISCOVERY_LOCATOR_ENABLED}"
      SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_LOWER_CASE_SERVICE_ID: "${API_GATEWAY_DISCOVERY_LOWER_CASE_SERVICE_ID}"
      SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_FILTERS_0: "${API_GATEWAY_DISCOVERY_FILTERS_0}"
      # OpenAPI Configuration
      SPRINGDOC_SWAGGER_UI_CONFIG_URL: "${API_GATEWAY_SWAGGER_CONFIG_URL}"
      # Logging Configuration
      LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_CLOUD_GATEWAY: "${API_GATEWAY_LOG_SPRING_CLOUD_GATEWAY}"
      LOGGING_LEVEL_ORG_SPRINGDOC: "${API_GATEWAY_LOG_SPRINGDOC}"
      LOGGING_LEVEL_REACTOR_NETTY: "${API_GATEWAY_LOG_REACTOR_NETTY}"
    depends_on:
      - identity-service
      - discovery-server
    networks:
      - planbook

  # Master Data Service
  master-data-service:
    image: ${DOCKERHUB_USERNAME}/planbook-master-data-service:latest
    container_name: planbook-master-data-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      # Database Configuration
      SPRING_DATASOURCE_URL: "${MASTER_DATA_DB_URL}"
      SPRING_DATASOURCE_USERNAME: "${MASTER_DATA_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${MASTER_DATA_DB_PASSWORD}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      # JPA Configuration
      SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      # Server Configuration
      SERVER_PORT: "8080"
      # Supabase Configuration
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      # Kafka Configuration
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      # Redis Configuration
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      # Thymeleaf Configuration
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      # JWT Configuration
      SPRING_JWT_PRIVATE_KEY_PATH: "${MASTER_DATA_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${MASTER_DATA_JWT_PUBLIC_KEY_PATH}"
      # Forward Headers Configuration
      SERVER_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      # OpenAPI Configuration
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      # Service Discovery Configuration
      SPRING_APPLICATION_NAME: "${MASTER_DATA_APP_NAME}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      EUREKA_INSTANCE_HOSTNAME: "master-data-service"
      # Duration Configuration
      SPRING_DURATION: "${SHARED_DURATION_SECONDS}"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      # Mail Configuration
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # Purchase Service
  purchase-service:
    image: ${DOCKERHUB_USERNAME}/planbook-purchase-service:latest
    container_name: planbook-purchase-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      # Application Configuration
      SPRING_APPLICATION_NAME: "${PURCHASE_APP_NAME}"
      SERVER_PORT: "8080"
      # Database Configuration
      SPRING_DATASOURCE_URL: "${PURCHASE_DB_URL}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      SPRING_DATASOURCE_USERNAME: "${PURCHASE_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${PURCHASE_DB_PASSWORD}"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      # JPA Configuration
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_JPA_DATABASE_PLATFORM: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      # Service Discovery Configuration
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      EUREKA_INSTANCE_HOSTNAME: "purchase-service"
      # Kafka Configuration
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      # Redis Configuration
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      # Thymeleaf Configuration
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      # Mail Configuration
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      SPRING_MAIL_HEALTH_ENABLED: "${PURCHASE_MAIL_HEALTH_ENABLED}"
      # Forward Headers Configuration
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      # OpenAPI Configuration
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      # Duration Configuration
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      # Supabase Configuration
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      # PayOS Configuration
      PAYOS_CLIENT_ID: "${PURCHASE_PAYOS_CLIENT_ID}"
      PAYOS_API_KEY: "${PURCHASE_PAYOS_API_KEY}"
      PAYOS_CHECKSUM_KEY: "${PURCHASE_PAYOS_CHECKSUM_KEY}"
      PAYOS_RETURN_URL: "${PURCHASE_PAYOS_RETURN_URL}"
      PAYOS_CANCEL_URL: "${PURCHASE_PAYOS_CANCEL_URL}"
      PAYOS_WEBHOOK_URL: "${PURCHASE_PAYOS_WEBHOOK_URL}"
      # SendGrid Configuration
      SPRING_SENDGRID_TEMPLATE_ORDER: "${PURCHASE_SENDGRID_TEMPLATE_ORDER}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook




  # Exam Service
  exam-service:
    image: ${DOCKERHUB_USERNAME}/planbook-exam-service:latest
    container_name: planbook-exam-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${EXAM_APP_NAME}"
      SERVER_PORT: "8080"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      SPRING_DATASOURCE_URL: "${EXAM_DB_URL}"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      SPRING_DATASOURCE_USERNAME: "${EXAM_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${EXAM_DB_PASSWORD}"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_JPA_DATABASE_PLATFORM: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      SPRING_JWT_PRIVATE_KEY_PATH: "${EXAM_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${EXAM_JWT_PUBLIC_KEY_PATH}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # External Caller Service
  external-caller-service:
    image: ${DOCKERHUB_USERNAME}/planbook-external-caller-service:latest
    container_name: planbook-external-caller-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${EXTERNAL_CALLER_APP_NAME}"
      SERVER_PORT: "8080"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      EUREKA_INSTANCE_HOSTNAME: "external-caller-service"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_DATA_REDIS_TIMEOUT: "${EXTERNAL_CALLER_REDIS_TIMEOUT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRINGDOC_SWAGGER_UI_CONFIG_URL: "${EXTERNAL_CALLER_SWAGGER_CONFIG_URL}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_CLOUD_GATEWAY: "${EXTERNAL_CALLER_LOG_SPRING_CLOUD_GATEWAY}"
      LOGGING_LEVEL_ORG_SPRINGDOC: "${EXTERNAL_CALLER_LOG_SPRINGDOC}"
      LOGGING_LEVEL_REACTOR_NETTY: "${EXTERNAL_CALLER_LOG_REACTOR_NETTY}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # External Tool Config Service
  external-tool-config-service:
    image: ${DOCKERHUB_USERNAME}/planbook-external-tool-config-service:latest
    container_name: planbook-external-tool-config-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${EXTERNAL_TOOL_CONFIG_APP_NAME}"
      SERVER_PORT: "8080"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      # Database Configuration
      SPRING_DATASOURCE_URL: "${EXTERNAL_TOOL_CONFIG_DB_URL}"
      SPRING_DATASOURCE_USERNAME: "${EXTERNAL_TOOL_CONFIG_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${EXTERNAL_TOOL_CONFIG_DB_PASSWORD}"
      # JPA Configuration
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_JPA_DATABASE_PLATFORM: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      # Service Discovery Configuration
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      EUREKA_INSTANCE_HOSTNAME: "external-tool-config-service"
      # Kafka Configuration
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      # Redis Configuration
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      # Thymeleaf Configuration
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      # Mail Configuration
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      # Forward Headers Configuration
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      # OpenAPI Configuration
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      # Duration Configuration
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      # Supabase Configuration
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      # JWT Configuration
      SPRING_JWT_PRIVATE_KEY_PATH: "${EXTERNAL_TOOL_CONFIG_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${EXTERNAL_TOOL_CONFIG_JWT_PUBLIC_KEY_PATH}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # Slide Template Service
  slide-template-service:
    image: ${DOCKERHUB_USERNAME}/planbook-slide-template-service:latest
    container_name: planbook-slide-template-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${SLIDE_TEMPLATE_APP_NAME}"
      SERVER_PORT: "8080"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      SPRING_DATASOURCE_URL: "${SLIDE_TEMPLATE_DB_URL}"
      SPRING_DATASOURCE_USERNAME: "${SLIDE_TEMPLATE_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${SLIDE_TEMPLATE_DB_PASSWORD}"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_JPA_DATABASE_PLATFORM: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      SPRING_MAIL_HEALTH_ENABLED: "${SLIDE_TEMPLATE_MAIL_HEALTH_ENABLED}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      SPRING_JWT_PRIVATE_KEY_PATH: "${SLIDE_TEMPLATE_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${SLIDE_TEMPLATE_JWT_PUBLIC_KEY_PATH}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # Websocket Service
  websocket-service:
    image: ${DOCKERHUB_USERNAME}/planbook-websocket-service:latest
    container_name: planbook-websocket-service
    restart: always
    pull_policy: always
    ports:
      - "${WEBSOCKET_PORT}:${WEBSOCKET_PORT}"
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${WEBSOCKET_APP_NAME}"
      SERVER_PORT: "${WEBSOCKET_PORT}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${WEBSOCKET_KAFKA_TOPIC}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SPRING_JWT_PRIVATE_KEY_PATH: "${ACADEMIC_RESOURCE_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${ACADEMIC_RESOURCE_JWT_PUBLIC_KEY_PATH}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook

 # Email Service      
  email-service:
      image: ${DOCKERHUB_USERNAME}/planbook-email-service:latest
      container_name: planbook-email-service
      restart: always
      pull_policy: always
      ports:
        - "${EMAIL_PORT}:${EMAIL_PORT}"
      environment:
        SPRING_PROFILES_ACTIVE: "prod"
        SPRING_APPLICATION_NAME: "${EMAIL_APP_NAME}"
        SERVER_PORT: "${EMAIL_PORT}"
        SPRING_APPLICATION_JSON: >
         {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
        EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
        EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
        EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
        EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
        MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
        MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
        SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
        SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
        SPRING_SENDGRID_API_KEY: "${EMAIL_SENDGRID_API_KEY}"
        SPRING_SENDGRID_FROM_EMAIL: "${EMAIL_SENDGRID_FROM_EMAIL}"
      depends_on:
        - discovery-server
        - kafka
      networks:
        - planbook      


  # Academic Resource Service
  academic-resource-service:
    image: ${DOCKERHUB_USERNAME}/planbook-academic-resource-service:latest
    container_name: planbook-academic-resource-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${ACADEMIC_RESOURCE_APP_NAME}"
      SERVER_PORT: "8080"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      SPRING_DATASOURCE_URL: "${ACADEMIC_RESOURCE_DB_URL}"
      SPRING_DATASOURCE_USERNAME: "${ACADEMIC_RESOURCE_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${ACADEMIC_RESOURCE_DB_PASSWORD}"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_JPA_DATABASE_PLATFORM: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      SPRING_JWT_PRIVATE_KEY_PATH: "${ACADEMIC_RESOURCE_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${ACADEMIC_RESOURCE_JWT_PUBLIC_KEY_PATH}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # Lesson Plan Template Service
  lesson-plan-template-service:
    image: ${DOCKERHUB_USERNAME}/planbook-lesson-plan-template-service:latest
    container_name: planbook-lesson-plan-template-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${LESSON_PLAN_TEMPLATE_APP_NAME}"
      SERVER_PORT: "8080"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      SPRING_DATASOURCE_URL: "${LESSON_PLAN_TEMPLATE_DB_URL}"
      SPRING_DATASOURCE_USERNAME: "${LESSON_PLAN_TEMPLATE_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${LESSON_PLAN_TEMPLATE_DB_PASSWORD}"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_JPA_DATABASE_PLATFORM: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      SPRING_MAIL_HEALTH_ENABLED: "${LESSON_PLAN_TEMPLATE_MAIL_HEALTH_ENABLED}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      SPRING_JWT_PRIVATE_KEY_PATH: "${LESSON_PLAN_TEMPLATE_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${LESSON_PLAN_TEMPLATE_JWT_PUBLIC_KEY_PATH}"
      SPRING_KAFKA_CONSUMER_GROUP_ID: "${LESSON_PLAN_TEMPLATE_KAFKA_CONSUMER_GROUP}"
      SPRING_KAFKA_CONSUMER_AUTO_OFFSET_RESET: "${LESSON_PLAN_TEMPLATE_KAFKA_AUTO_OFFSET_RESET}"
      SPRING_KAFKA_CONSUMER_KEY_DESERIALIZER: "${LESSON_PLAN_TEMPLATE_KAFKA_KEY_DESERIALIZER}"
      SPRING_KAFKA_CONSUMER_VALUE_DESERIALIZER: "${LESSON_PLAN_TEMPLATE_KAFKA_VALUE_DESERIALIZER}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # Tool Log Service
  tool-log-service:
    image: ${DOCKERHUB_USERNAME}/planbook-tool-log-service:latest
    container_name: planbook-tool-log-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${TOOL_LOG_APP_NAME}"
      SERVER_PORT: "8080"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      SPRING_DATASOURCE_URL: "${TOOL_LOG_DB_URL}"
      SPRING_DATASOURCE_USERNAME: "${TOOL_LOG_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${TOOL_LOG_DB_PASSWORD}"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_JPA_DATABASE_PLATFORM: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      SPRING_MAIL_HEALTH_ENABLED: "${TOOL_LOG_MAIL_HEALTH_ENABLED}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      SPRING_JWT_PRIVATE_KEY_PATH: "${TOOL_LOG_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${TOOL_LOG_JWT_PUBLIC_KEY_PATH}"
      SPRING_KAFKA_CONSUMER_GROUP_ID: "${TOOL_LOG_KAFKA_CONSUMER_GROUP}"
      SPRING_KAFKA_CONSUMER_AUTO_OFFSET_RESET: "${TOOL_LOG_KAFKA_AUTO_OFFSET_RESET}"
      SPRING_KAFKA_CONSUMER_KEY_DESERIALIZER: "${TOOL_LOG_KAFKA_KEY_DESERIALIZER}"
      SPRING_KAFKA_CONSUMER_VALUE_DESERIALIZER: "${TOOL_LOG_KAFKA_VALUE_DESERIALIZER}"
      KAFKA_TOPIC_NAME_REQUEST: "${TOOL_LOG_KAFKA_TOPIC_REQUEST}"
      KAFKA_TOPIC_NAME_RESPONSE: "${TOOL_LOG_KAFKA_TOPIC_RESPONSE}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # Workspace Service
  workspace-service:
    image: ${DOCKERHUB_USERNAME}/planbook-workspace-service:latest
    container_name: planbook-workspace-service
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${WORKSPACE_APP_NAME}"
      SERVER_PORT: "8080"
      MANAGEMENT_HEALTH_MAIL_ENABLED: "${SHARED_MAIL_HEALTH_ENABLED}"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      SPRING_DATASOURCE_URL: "${WORKSPACE_DB_URL}"
      SPRING_DATASOURCE_USERNAME: "${WORKSPACE_DB_USERNAME}"
      SPRING_DATASOURCE_PASSWORD: "${WORKSPACE_DB_PASSWORD}"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "${SHARED_HIBERNATE_DDL_AUTO}"
      SPRING_JPA_DATABASE_PLATFORM: "${SHARED_HIBERNATE_DIALECT}"
      SPRING_MAIN_ALLOW_CIRCULAR_REFERENCES: "${SHARED_ALLOW_CIRCULAR_REFERENCES}"
      SPRING_MVC_PATHMATCH_MATCHING_STRATEGY: "${SHARED_PATHMATCH_STRATEGY}"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      SPRING_THYMELEAF_PREFIX: "${SHARED_THYMELEAF_PREFIX}"
      SPRING_THYMELEAF_SUFFIX: "${SHARED_THYMELEAF_SUFFIX}"
      SPRING_THYMELEAF_MODE: "${SHARED_THYMELEAF_MODE}"
      SPRING_MAIL_HOST: "${SHARED_MAIL_HOST}"
      SPRING_MAIL_PORT: "${SHARED_MAIL_PORT}"
      SPRING_MAIL_USERNAME: "${SHARED_MAIL_USERNAME}"
      SPRING_MAIL_PASSWORD: "${SHARED_MAIL_PASSWORD}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "${SHARED_MAIL_SMTP_AUTH}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "${SHARED_MAIL_SMTP_STARTTLS_ENABLE}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_REQUIRED: "${SHARED_MAIL_SMTP_STARTTLS_REQUIRED}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_CONNECTIONTIMEOUT: "${SHARED_MAIL_SMTP_CONNECTIONTIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_TIMEOUT: "${SHARED_MAIL_SMTP_TIMEOUT}"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_WRITETIMEOUT: "${SHARED_MAIL_SMTP_WRITETIMEOUT}"
      SPRING_MAIL_DEFAULT_ENCODING: "${SHARED_MAIL_DEFAULT_ENCODING}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
      SPRING_JWT_PRIVATE_KEY_PATH: "${WORKSPACE_JWT_PRIVATE_KEY_PATH}"
      SPRING_JWT_PUBLIC_KEY_PATH: "${WORKSPACE_JWT_PUBLIC_KEY_PATH}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook


  # Aggregator Service
  aggregator:
    image: ${DOCKERHUB_USERNAME}/planbook-aggregator:latest
    container_name: planbook-aggregator
    restart: always
    pull_policy: always
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SPRING_APPLICATION_NAME: "${AGGREGATOR_APP_NAME}"
      SERVER_PORT: "8080"
      SPRING_APPLICATION_JSON: >
       {"eureka":{"client":{"serviceUrl":{"defaultZone":"http://discovery-server:8761/eureka"}}}}
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "${SHARED_EUREKA_DEFAULT_ZONE}"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "${SHARED_EUREKA_REGISTER_WITH_EUREKA}"
      EUREKA_CLIENT_FETCH_REGISTRY: "${SHARED_EUREKA_FETCH_REGISTRY}"
      EUREKA_CLIENT_HEALTHCHECK_ENABLED: "${SHARED_EUREKA_HEALTHCHECK_ENABLED}"
      MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "${SHARED_MANAGEMENT_EXPOSURE}"
      MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "${SHARED_MANAGEMENT_HEALTH_DETAILS}"
      EUREKA_INSTANCE_HOSTNAME: "aggregator"
      SPRING_KAFKA_BOOTSTRAP_SERVERS: "${SHARED_KAFKA_BOOTSTRAP_SERVERS}"
      SPRING_KAFKA_TOPIC_NAME: "${SHARED_KAFKA_TOPIC_PLANBOOK}"
      SPRING_DATA_REDIS_HOST: "${SHARED_REDIS_HOST}"
      SPRING_DATA_REDIS_PORT: "${SHARED_REDIS_PORT}"
      SPRING_CACHE_TYPE: "${SHARED_CACHE_TYPE}"
      SPRING_WEBFLUX_FORWARD_HEADERS_STRATEGY: "${SHARED_FORWARD_HEADERS_STRATEGY}"
      SPRINGDOC_API_DOCS_PATH: "${SHARED_OPENAPI_DOCS_PATH}"
      SPRING_DURATION_SECONDS: "${SHARED_DURATION_SECONDS}"
      SUPABASE_JWT_SECRET: "${SHARED_SUPABASE_JWT_SECRET}"
      SUPABASE_URL: "${SHARED_SUPABASE_URL}"
      SUPABASE_KEY: "${SHARED_SUPABASE_KEY}"
      SUPABASE_STORAGE_BUCKET: "${SHARED_SUPABASE_BUCKET}"
    depends_on:
      - discovery-server
      - kafka
    networks:
      - planbook

volumes:
  kafka_data:
  portainer_data:
  
networks:
  planbook:
    external: true
